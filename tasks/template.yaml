version: 3

vars:
  ADDON_MANIFEST_PATH_RAW: "{{.ADDON_DIRECTORY}}/{{.ADDON_NAME}}.txt"
  ADDON_MANIFEST_PATH: "{{fromSlash .ADDON_MANIFEST_PATH_RAW}}"
  TEMPLATE: |
    ## Title: {{.ADDON_NAME}}
    ## APIVersion: {{.API_VERSION}}
    ## Author: {{.AUTHOR}}
    ## Description: {{.DESCRIPTION}}\n

includes:
  register:
    taskfile: "register.yaml"
    internal: true
  src:
    taskfile: "source_files.yaml"
    internal: true
  ui:
    taskfile: "ui_files.yaml"
    internal: true
  custom:
    taskfile: "custom_resources.yaml"
    internal: true

tasks:
  template:
    internal: true
    cmds:
      - cmd: printf "{{.TEMPLATE}}" > "{{.ADDON_MANIFEST_PATH}}"
        silent: true

  default:
    cmds:
      - cmd: echo "Writing register function to {{.ADDON_REGISTER_PATH}}"
        silent: true
      - task: register:register
      - cmd: echo Generating addon manifest at "{{.ADDON_MANIFEST_PATH}}"
        silent: true
      - task: print
      - task: register:add-source-to-manifest
      - task: src
      - task: ui
      - task: custom
